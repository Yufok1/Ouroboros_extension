{
  "id": "gemma-rag-cascade",
  "name": "Gemma RAG with CASCADE Provenance",
  "version": "1.0.0",
  "description": "Full RAG workflow with CASCADE provenance tracking, causation graphs, and observability",
  "status": "operational",
  "tested": "2026-02-13",
  "success_rate": "100%",
  "nodes": [
    {
      "id": "start",
      "type": "input",
      "description": "User query input"
    },
    {
      "id": "create_chain",
      "type": "tool",
      "tool_name": "cascade_chain",
      "parameters": {
        "operation": "create_chain",
        "params": "{\"session_id\": \"rag_$uuid\", \"model_id\": \"gemma-3-1b\", \"model_hash\": \"b092667928d81f45\", \"input_hash\": \"$input.query\"}"
      },
      "description": "Create CASCADE provenance chain"
    },
    {
      "id": "create_graph",
      "type": "tool",
      "tool_name": "cascade_graph",
      "parameters": {
        "operation": "create",
        "params": "{\"graph_id\": \"rag_$uuid\"}"
      },
      "description": "Create CASCADE causation graph"
    },
    {
      "id": "log_query",
      "type": "tool",
      "tool_name": "cascade_graph",
      "parameters": {
        "operation": "add_event",
        "params": "{\"graph_id\": \"rag_$uuid\", \"component\": \"query\", \"event_type\": \"user_input\", \"data\": {\"query\": \"$input.query\", \"timestamp\": \"$now\"}}"
      },
      "description": "Log query event to causation graph"
    },
    {
      "id": "bag_search",
      "type": "tool",
      "tool_name": "bag_search",
      "parameters": {
        "query": "$input.query",
        "limit": 5
      },
      "description": "Search FelixBag for relevant context"
    },
    {
      "id": "log_retrieval",
      "type": "tool",
      "tool_name": "cascade_graph",
      "parameters": {
        "operation": "add_event",
        "params": "{\"graph_id\": \"rag_$uuid\", \"component\": \"retrieval\", \"event_type\": \"bag_search\", \"data\": {\"results_count\": 5, \"timestamp\": \"$now\"}}"
      },
      "description": "Log retrieval event to causation graph"
    },
    {
      "id": "link_query_retrieval",
      "type": "tool",
      "tool_name": "cascade_graph",
      "parameters": {
        "operation": "add_link",
        "params": "{\"graph_id\": \"rag_$uuid\", \"from_event\": \"query_event\", \"to_event\": \"retrieval_event\", \"causation_type\": \"triggers\", \"strength\": 1.0, \"explanation\": \"User query triggers bag search\"}"
      },
      "description": "Link query to retrieval (causation)"
    },
    {
      "id": "record_retrieval",
      "type": "tool",
      "tool_name": "cascade_chain",
      "parameters": {
        "operation": "add_record",
        "params": "{\"chain_id\": \"rag_$uuid\", \"record_type\": \"retrieval\", \"data\": {\"query\": \"$input.query\", \"results\": \"$node.bag_search.results\"}}"
      },
      "description": "Record retrieval in provenance chain"
    },
    {
      "id": "generate",
      "type": "tool",
      "tool_name": "generate",
      "parameters": {
        "prompt": "Based on the following context from memory, answer the query.\n\nQuery: $input.query\n\nContext: Retrieved from FelixBag\n\nProvide a comprehensive response:",
        "max_tokens": 512
      },
      "description": "Generate response with Gemma-3-1B"
    },
    {
      "id": "log_generation",
      "type": "tool",
      "tool_name": "cascade_graph",
      "parameters": {
        "operation": "add_event",
        "params": "{\"graph_id\": \"rag_$uuid\", \"component\": \"generation\", \"event_type\": \"gemma_output\", \"data\": {\"tokens\": 512, \"timestamp\": \"$now\"}}"
      },
      "description": "Log generation event to causation graph"
    },
    {
      "id": "record_generation",
      "type": "tool",
      "tool_name": "cascade_chain",
      "parameters": {
        "operation": "add_record",
        "params": "{\"chain_id\": \"rag_$uuid\", \"record_type\": \"generation\", \"data\": {\"output\": \"$node.generate.output\", \"model\": \"gemma-3-1b\"}}"
      },
      "description": "Record generation in provenance chain"
    },
    {
      "id": "finalize_chain",
      "type": "tool",
      "tool_name": "cascade_chain",
      "parameters": {
        "operation": "finalize",
        "params": "{\"chain_id\": \"rag_$uuid\"}"
      },
      "description": "Finalize provenance chain (merkle root)"
    },
    {
      "id": "end",
      "type": "output",
      "description": "Output response and provenance"
    }
  ],
  "connections": [
    {"from": "start", "to": "create_chain"},
    {"from": "create_chain", "to": "create_graph"},
    {"from": "create_graph", "to": "log_query"},
    {"from": "log_query", "to": "bag_search"},
    {"from": "bag_search", "to": "log_retrieval"},
    {"from": "log_retrieval", "to": "link_query_retrieval"},
    {"from": "link_query_retrieval", "to": "record_retrieval"},
    {"from": "record_retrieval", "to": "generate"},
    {"from": "generate", "to": "log_generation"},
    {"from": "log_generation", "to": "record_generation"},
    {"from": "record_generation", "to": "finalize_chain"},
    {"from": "finalize_chain", "to": "end"}
  ],
  "performance": {
    "average_execution_ms": 22724,
    "generation_ms": 22658,
    "retrieval_ms": 64,
    "cascade_overhead_ms": 2,
    "success_rate": 1.0
  },
  "test_executions": [
    {
      "execution_id": "exec_685d856709b9",
      "query": "Gemma attention mechanism",
      "elapsed_ms": 22856,
      "merkle_root": "4fcd7d2a62aa31a3"
    },
    {
      "execution_id": "exec_b13f575ceec3",
      "query": "Entropy Loop",
      "elapsed_ms": 22052,
      "merkle_root": "4fcd7d2a62aa31a3"
    },
    {
      "execution_id": "exec_462bd2eb4596",
      "query": "CASCADE provenance",
      "elapsed_ms": 23264,
      "merkle_root": "4fcd7d2a62aa31a3"
    }
  ]
}
